<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solving a word funnel programming challenge ‚Ä¢ funnel</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Solving a word funnel programming challenge">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">funnel</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/funnel.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pegeler/dailyprogrammer/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Solving a word funnel programming challenge</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pegeler/dailyprogrammer/blob/HEAD/vignettes/funnel.Rmd" class="external-link"><code>vignettes/funnel.Rmd</code></a></small>
      <div class="hidden name"><code>funnel.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="table-of-contents">Table of Contents<a class="anchor" aria-label="anchor" href="#table-of-contents"></a>
</h2>
<ul>
<li>
<a href="#introduction">Introduction</a>
</li>
<li>
<a href="#installation">Installation</a>
</li>
<li>
<a href="#part-1">Part 1</a>
</li>
<ul>
<li>
<a href="#prompt">Prompt</a>
</li>
<li>
<a href="#example-output">Example Output</a>
</li>
<li>
<a href="#solution">Solution</a>
</li>
<li>
<a href="#tests">Tests</a>
</li>
<li>
<a href="#performance">Performance</a>
</li>
</ul>
<li>
<a href="#part-1-bonus-1">Part 1 Bonus 1</a>
</li>
<ul>
<li>
<a href="#prompt-1">Prompt</a>
</li>
<li>
<a href="#example-output-1">Example Output</a>
</li>
<li>
<a href="#external-datasets">External Datasets</a>
</li>
<li>
<a href="#solution-1">Solution</a>
</li>
<ul>
<li>
<a href="#roxygen-comments">Roxygen Comments</a>
</li>
<li>
<a href="#support-functions">Support Functions</a>
</li>
<li>
<a href="#back-to-the-solution">Back to the Solution</a>
</li>
</ul>
<li>
<a href="#search-algorithms">Search Algorithms</a>
</li>
<ul>
<li>
<a href="#binary-search">Binary Search</a>
</li>
<li>
<a href="#hash-table">Hash Table</a>
</li>
<li>
<a href="#set">Set</a>
</li>
<li>
<a href="#benchmark">Benchmark</a>
</li>
</ul>
</ul>
<li>
<a href="#part-1-bonus-2">Part 1 Bonus 2</a>
</li>
<ul>
<li>
<a href="#prompt-2">Prompt</a>
</li>
<li>
<a href="#solution-2">Solution</a>
</li>
</ul>
<li>
<a href="#part-2">Part 2</a>
</li>
<ul>
<li>
<a href="#prompt-3">Prompt</a>
</li>
<li>
<a href="#example-output-2">Example Output</a>
</li>
<li>
<a href="#solution-3">Solution</a>
</li>
<li>
<a href="#recursion">Recursion</a>
</li>
<ul>
<li>
<a href="#tail-call-optimization">Tail Call Optimization</a>
</li>
</ul>
<li>
<a href="#rcpp">Rcpp</a>
</li>
<li>
<a href="#benchmark-1">Benchmark</a>
</li>
<li>
<a href="#python">Python</a>
</li>
</ul>
<li>
<a href="#part-2-bonus">Part 2 Bonus</a>
</li>
<ul>
<li>
<a href="#solution-4">Solution</a>
</li>
</ul>
<li>
<a href="#part-2-bonus-2">Part 2 Bonus 2</a>
</li>
<ul>
<li>
<a href="#solution-5">Solution</a>
</li>
<ul>
<li>
<a href="#python-1">Python</a>
</li>
</ul>
</ul>
<li>
<a href="#conclusion">Conclusion</a>
</li>
</ul>
<p><em><small>Generated with <a href="https://github.com/pegeler/tocgen" class="external-link">tocgen</a></small></em></p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This package solves the two reddit r/dailyprogrammer challenges: <a href="https://www.reddit.com/r/dailyprogrammer/comments/98ufvz/20180820_challenge_366_easy_word_funnel_1/" class="external-link">word
funnel 1</a> and <a href="https://www.reddit.com/r/dailyprogrammer/comments/99d24u/20180822_challenge_366_intermediate_word_funnel_2/" class="external-link">word
funnel 2</a>. We will be using them as a pedagogical tool to explore
advanced R concepts. Concepts include:</p>
<ul>
<li>Functional programming in R
<ul>
<li>Recursion</li>
<li>Closures</li>
<li>Pipes (<code>|&gt;</code>)</li>
<li>Higher order functions
<ul>
<li>Applying functions over collections (map-like operations)</li>
<li>Passing functions into functions and returning functions from
functions</li>
</ul>
</li>
</ul>
</li>
<li>The Rcpp package
<ul>
<li>Including Rcpp in a package</li>
<li>Identifying performance bottlenecks in R code and rewriting them in
C++</li>
<li>Passing around pointers to C++ objects within the R session using <a href="https://www.r-bloggers.com/2010/01/external-pointers-with-rcpp/" class="external-link"><code>Rcpp::Xptr()</code></a>
</li>
<li>Implicit conversion between R types and C++ primitive, standard
library, and standard template library (STL) types</li>
</ul>
</li>
<li>Data structures and algorithms
<ul>
<li>Comparing the performance of various search algorithms, including
linear, binary, set membership, and hashmap membership.</li>
<li>Using the C++ standard library to gain access to a variety of
container types and algorithms not available in base R</li>
<li>Using non-standard R data types (<a href="https://stat.ethz.ch/R-manual/R-devel/library/utils/html/hashtab.html" class="external-link"><code>hashtab()</code></a>)
to improve performance</li>
</ul>
</li>
<li>Literate programming in R
<ul>
<li>Package-oriented <a href="https://www.jstor.org/stable/27594227" class="external-link">project compendium</a>
</li>
<li>Creating package datasets and tests to augment the compendium</li>
<li>Documenting supporting functions using <a href="https://cran.r-project.org/package=roxygen2" class="external-link">Roxygen</a>
</li>
<li>Vignettes as project write-ups using <a href="https://cran.r-project.org/package=rmarkdown" class="external-link">Rmarkdown</a> (this
document)</li>
</ul>
</li>
</ul>
<p>These toy problems will provide just enough complexity to warrant a
package-oriented project compendium and showcase its strengths, while
remaining simple enough so as not to get lost in project details. The
challenges are also easy to understand but of sufficient depth that they
can be implemented a naive way and a more sophisticated way to compare
performance.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>To play along at home, install the package with the following. You
will need build tools to do so.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"remotes"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"pegeler/dailyprogrammer/366-word-funnel-r-pkg"</span><span class="op">)</span></span></code></pre></div>
<p>We also need to load a few libraries.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pegeler/dailyprogrammer" class="external-link">funnel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="part-1">Part 1<a class="anchor" aria-label="anchor" href="#part-1"></a>
</h2>
<div class="section level3">
<h3 id="prompt">Prompt<a class="anchor" aria-label="anchor" href="#prompt"></a>
</h3>
<blockquote>
<p>Given two strings of letters, determine whether the second can be
made from the first by removing one letter. The remaining letters must
stay in the same order.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="example-output">Example Output<a class="anchor" aria-label="anchor" href="#example-output"></a>
</h3>
<pre><code>funnel("leave", "eave") =&gt; true
funnel("reset", "rest") =&gt; true
funnel("dragoon", "dragon") =&gt; true
funnel("eave", "leave") =&gt; false
funnel("sleet", "lets") =&gt; false
funnel("skiff", "ski") =&gt; false</code></pre>
</div>
<div class="section level3">
<h3 id="solution">Solution<a class="anchor" aria-label="anchor" href="#solution"></a>
</h3>
<p>In the trivial case, we can be assured the result is
<code>FALSE</code> if the number of characters in the second string is
not one less than the first. Otherwise, we will need to examine each
string by indexing into it. In R, we can index into a single string in a
character vector, but we cannot index into a single character in that
string. So the approach here will be to split each string using
<code>strplit()</code>. This will likely cause a fairly significant
performance hit over a language like Python or C++ because it will
result in memory allocations for two new character vectors (plus a list
to contain them). Not to mention the overhead for doing the split. This
challenge can be fairly easily completed in R but it will not be
efficient.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_funnel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># If nchar is not n - 1 then it is definitely wrong</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Fragment each word into character vector</span></span>
<span>  <span class="va">strings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Remove each character one by one and find out the resulting vector matches b</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">strings</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      \<span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">strings</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="va">strings</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The Rcpp implementation is radically simpler. Note that Rcpp will
automatically convert a single-element R character vector into the C++
standard library‚Äôs string type <code>std::string</code>. From there, we
can access each element of each string using the <code>[]</code>
operator to do our comparisons.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="dt">bool</span> cpp_funnel<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op"> &amp;</span>a<span class="op">,</span> <span class="at">const</span> <span class="bu">std::</span>string<span class="op"> &amp;</span>b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="dt">size_t</span> b_len <span class="op">=</span> b<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>a<span class="op">.</span>size<span class="op">()</span> <span class="op">!=</span> b_len <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="dt">bool</span> skipped <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="cf">for</span><span class="op">(</span><span class="dt">size_t</span> i<span class="op">=</span><span class="dv">0</span><span class="op">,</span> j<span class="op">=</span><span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> b_len<span class="op">;)</span> <span class="op">{</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>a<span class="op">[</span>i<span class="op">]</span> <span class="op">!=</span> b<span class="op">[</span>j<span class="op">])</span> <span class="op">{</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>skipped<span class="op">)</span> <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>      skipped <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>      i<span class="op">++;</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>    <span class="cf">else</span> i<span class="op">++,</span> j<span class="op">++;</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Adding an Rcpp function to this project was very quick using
<code>usethis::use_rcpp("funnel")</code>. It automatically set up quite
a bit of the necessary Rcpp infrastructure in my project and provided
some additional instructions. From there, it‚Äôs almost as simple as just
writing the code and then calling it in R. There are a few extra steps
about exporting the functions you intend to use in your R session or
make available to the public API, but those are outside of the scope of
this conversation.</p>
</div>
<div class="section level3">
<h3 id="tests">Tests<a class="anchor" aria-label="anchor" href="#tests"></a>
</h3>
<p>This is the first instance where we demonstrate an advantage of using
package-oriented project compendia. We can include automated tests to
ensure that our functions are performing as expected and run those tests
with the touch of a button. Assuming our project is already set up as a
package, running <code>usethis::use_test("part1")</code> will set up
<code>testthat</code> in your project and create a new test file for you
to modify. We can put the following tests in the file and then run
<kbd>Ctrl</kbd> + <kbd>Shft</kbd> + <kbd>t</kbd> to run the tests. This
is especially useful for TDD enthusiasts to incorporate unit testing
into their project development work.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"R funnel works"</span>, <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/funnel.html">r_funnel</a></span><span class="op">(</span><span class="st">"leave"</span>, <span class="st">"eave"</span><span class="op">)</span>     <span class="op">|&gt;</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/funnel.html">r_funnel</a></span><span class="op">(</span><span class="st">"reset"</span>, <span class="st">"rest"</span><span class="op">)</span>     <span class="op">|&gt;</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/funnel.html">r_funnel</a></span><span class="op">(</span><span class="st">"dragoon"</span>, <span class="st">"dragon"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/funnel.html">r_funnel</a></span><span class="op">(</span><span class="st">"eave"</span>, <span class="st">"leave"</span><span class="op">)</span>     <span class="op">|&gt;</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_false</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/funnel.html">r_funnel</a></span><span class="op">(</span><span class="st">"sleet"</span>, <span class="st">"lets"</span><span class="op">)</span>     <span class="op">|&gt;</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_false</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/funnel.html">r_funnel</a></span><span class="op">(</span><span class="st">"skiff"</span>, <span class="st">"ski"</span><span class="op">)</span>      <span class="op">|&gt;</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_false</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Test passed</span> ü•á</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"Rcpp funnel works"</span>, <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/funnel.html">cpp_funnel</a></span><span class="op">(</span><span class="st">"leave"</span>, <span class="st">"eave"</span><span class="op">)</span>     <span class="op">|&gt;</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/funnel.html">cpp_funnel</a></span><span class="op">(</span><span class="st">"reset"</span>, <span class="st">"rest"</span><span class="op">)</span>     <span class="op">|&gt;</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/funnel.html">cpp_funnel</a></span><span class="op">(</span><span class="st">"dragoon"</span>, <span class="st">"dragon"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/funnel.html">cpp_funnel</a></span><span class="op">(</span><span class="st">"eave"</span>, <span class="st">"leave"</span><span class="op">)</span>     <span class="op">|&gt;</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_false</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/funnel.html">cpp_funnel</a></span><span class="op">(</span><span class="st">"sleet"</span>, <span class="st">"lets"</span><span class="op">)</span>     <span class="op">|&gt;</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_false</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/funnel.html">cpp_funnel</a></span><span class="op">(</span><span class="st">"skiff"</span>, <span class="st">"ski"</span><span class="op">)</span>      <span class="op">|&gt;</span> <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_false</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Test passed</span> üéä</span></span></code></pre></div>
<p>Yay! Both implementations return expected results for provided
example data. ü•≥</p>
<p>NB, For more on creating packages, I recommend <a href="https://r-pkgs.org/" class="external-link">Hadley Wickam‚Äôs <em>R Packages</em></a> and
the <a href="cran.r-project.org/package=usethis"><code>usethis</code>
package</a>.</p>
<p>NB, Although I will not explicitly show tests for each subsequent
challenge in this text, the package does in fact include tests for each
example output provided in the reddit post.</p>
</div>
<div class="section level3">
<h3 id="performance">Performance<a class="anchor" aria-label="anchor" href="#performance"></a>
</h3>
<p>It‚Äôs good that we were able to solve this problem in pure R since
there are various reasons why we might not want to get Rcpp involved.
For example,</p>
<ul>
<li>There is more overhead to get Rcpp set up.</li>
<li>The compilation step requires build tools for the target machine,
which are not always available by default.</li>
<li>C++ code is ‚Äúlower level‚Äù, which can make it more difficult to
reason about a problem vs a ‚Äúhigher level‚Äù language like R which is
designed for being expressive in a specific domain.</li>
<li>R is portable and very shareable.</li>
</ul>
<p>But there are times when either the advantages outweigh the
disadvantages or the disadvantages are minimized due to external
factors. R does lots of tricks under the hood to get good performance,
so going to C++ is not always a silver bullet. But some places where R
might need some help are in string handling, recursion and loops
(sometimes), and data structures and algorithms.</p>
<p>The disadvantage of needing build tools is minimized when shipping
code on <a href="https://cran.r-project.org/" class="external-link">CRAN</a> since they will
compile code to any target that may not have build tools pre-installed.
Packaging code is itself a strategy for making code more shareable.</p>
<p>This challenge is a string handling problem, which was selected
especially because it can be one of R‚Äôs weaker performance domains. (As
we‚Äôll see a little later, this challenge has several features that play
well to R‚Äôs weaknesses, which makes it an overall excellent candidate
for using Rcpp.) We might expect a significant difference in performance
when benchmarking, and indeed we see a ~16 fold speed gain using C++.
This could be very significant if this function is expected to be used
frequently, such as in a package meant for wide distribution or if it
needs to be used inside a tight loop (for example as part of an
exhaustive search over a large dataset).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/funnel.html">r_funnel</a></span><span class="op">(</span><span class="st">"sleet"</span>, <span class="st">"lets"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/funnel.html">cpp_funnel</a></span><span class="op">(</span><span class="st">"sleet"</span>, <span class="st">"lets"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 √ó 6</span></span></span>
<span><span class="co">#&gt;   expression                            min  median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:t&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">"</span>r_funnel(\"sleet\", \"lets\")<span style="color: #949494;">"</span>    9.74¬µs  12.1¬µs    <span style="text-decoration: underline;">74</span>282.        0B     22.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="color: #949494;">"</span>cpp_funnel(\"sleet\", \"lets\"‚Ä¶ 748.09ns 816.1ns   <span style="text-decoration: underline;">973</span>600.    2.49KB      0</span></span>
<span></span>
<span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/funnel.html">r_funnel</a></span><span class="op">(</span><span class="st">"dragoon"</span>, <span class="st">"dragon"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/funnel.html">cpp_funnel</a></span><span class="op">(</span><span class="st">"dragoon"</span>, <span class="st">"dragon"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 √ó 6</span></span></span>
<span><span class="co">#&gt;   expression                             min median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;bch:t&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">"</span>r_funnel(\"dragoon\", \"dragon\"‚Ä¶  12.1¬µs   15¬µs    <span style="text-decoration: underline;">59</span>605.        0B     23.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="color: #949494;">"</span>cpp_funnel(\"dragoon\", \"dragon‚Ä¶   766ns  841ns  1<span style="text-decoration: underline;">042</span>288.        0B      0</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="part-1-bonus-1">Part 1 Bonus 1<a class="anchor" aria-label="anchor" href="#part-1-bonus-1"></a>
</h2>
<div class="section level3">
<h3 id="prompt-1">Prompt<a class="anchor" aria-label="anchor" href="#prompt-1"></a>
</h3>
<blockquote>
<p>Given a string, find all words from the <a href="https://raw.githubusercontent.com/dolph/dictionary/master/enable1.txt" class="external-link">enable1
word list</a> that can be made by removing one letter from the string.
If there are two possible letters you can remove to make the same word,
only count it once. Ordering of the output words doesn‚Äôt matter.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="example-output-1">Example Output<a class="anchor" aria-label="anchor" href="#example-output-1"></a>
</h3>
<pre><code>bonus("dragoon") =&gt; ["dragon"]
bonus("boats") =&gt; ["oats", "bats", "bots", "boas", "boat"]
bonus("affidavit") =&gt; []</code></pre>
</div>
<div class="section level3">
<h3 id="external-datasets">External Datasets<a class="anchor" aria-label="anchor" href="#external-datasets"></a>
</h3>
<p>Before we get to the solution, note that the challenge now references
an external dataset. The <code>enable1</code> word list is a ~173k
element word list hosted on Github.</p>
<p>Since we will be referencing this data frequently, it would be
ergonomic to read the data in as an R object and then incorporate it
into our project in a serialized format. This is yet another advantage
of using a package-oriented project compendium approach. Datasets can be
associated with a package and accessed using the <code><a href="https://rdrr.io/r/utils/data.html" class="external-link">data()</a></code>
function. This pattern also supports reproducibility, such as
reproducible research.</p>
<p>With <code>usethis::use_data_raw("enable1")</code>, an R script file
is created in the project‚Äôs <em>data-raw/</em> folder. We will run this
once and then evermore will be able to load the <code>enable1</code>
word list simply by executing <code>data("enable1")</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Contents of data-raw/enable1.R</span></span>
<span><span class="va">enable1_url</span> <span class="op">&lt;-</span> <span class="st">'https://raw.githubusercontent.com/dolph/dictionary/master/enable1.txt'</span></span>
<span><span class="va">enable1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">enable1_url</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html" class="external-link">use_data</a></span><span class="op">(</span><span class="va">enable1</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="solution-1">Solution<a class="anchor" aria-label="anchor" href="#solution-1"></a>
</h3>
<p>Here is the solution. There is only an R version.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Part 1 Bonus Question</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Create a list of all funnel words that exist in a dictionary.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x The word used to create funnel words.</span></span>
<span><span class="co">#' @param search_func A function to check to see if a candidate word is in the</span></span>
<span><span class="co">#'    a dictionary.</span></span>
<span><span class="co">#' @seealso [search_func]</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' \dontrun{</span></span>
<span><span class="co">#' data(enable1)</span></span>
<span><span class="co">#' set_search_function &lt;- set_search(enable1)</span></span>
<span><span class="co">#' pt1_bonus("dragoon", set_search_function)</span></span>
<span><span class="co">#' }</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">pt1_bonus</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">search_func</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># First create all candidate words that would fit the rule</span></span>
<span>  <span class="va">candidates</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">remove_letter</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0L</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Subset legal words based on candidates</span></span>
<span>  <span class="va">candidates</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">candidates</span>, <span class="va">search_func</span>, <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Whoa! There‚Äôs a lot going on here! The solution itself is only about
2 lines of (dense) code. But what‚Äôs all this other stuff? Let‚Äôs hold off
on looking at the solution directly and understand what each component
is doing first. The R package system is doing a lot here in hiding
complexity and supporting good documentation practice, which makes our
2-line solution possible.</p>
<div class="section level4">
<h4 id="roxygen-comments">Roxygen Comments<a class="anchor" aria-label="anchor" href="#roxygen-comments"></a>
</h4>
<p>The first thing you might notice is that the comments above the
function use the <code>#'</code> syntax. These comments are special.
They are <a href="https://CRAN.R-project.org/package=roxygen2" class="external-link">Roxygen</a> comments,
which will be compiled into package help files. When this package is
loaded and installed, the help file can be accessed using
<code><a href="../reference/pt1_bonus.html">?pt1_bonus</a></code> just as you would look up any other manual page
(manpage) in R. They are the single best way to document functions in
R.</p>
<p>The Roxygen comments are particularly helpful here because we have a
parameter in this function signature whose purpose is not immediately
obvious: <code>search_func</code>. Fortunately, there is a
cross-reference to another manpage and an example to provide clarity.
Again, using a package-oriented project compendium has enhanced our
experience when working with potentially complex code.</p>
<p>NB, All public objects (and some private ones) have Roxygen comments.
I am only showing them once in this document for illustrative
purposes.</p>
</div>
<div class="section level4">
<h4 id="support-functions">Support Functions<a class="anchor" aria-label="anchor" href="#support-functions"></a>
</h4>
<p>The next thing you might notice is that there are several supporting
functions built into this package. We already mentioned
<code>search_func</code>, which has its own manpage and is part of the
public API (it‚Äôs visible to end-users). But there is also a
<code>remove_letter()</code> function buried in the body of the function
definition. This is a utility function that is only visible from within
the package! These sorts of functions can be effective in hiding away an
implementation detail so that you can <strong>maintain the proper level
of abstraction</strong> when solving your problem. <em>I. e.</em>,
you‚Äôre not bogged down solving sub-problems that distract from the main
problem.</p>
<p>NB, These supporting functions are getting unit tests too!</p>
</div>
<div class="section level4">
<h4 id="back-to-the-solution">Back to the Solution<a class="anchor" aria-label="anchor" href="#back-to-the-solution"></a>
</h4>
<p>The first line is this:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">candidates</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">remove_letter</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0L</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>It‚Äôs using the pipe operator to pass the result of each expression
into the next expression in a readable way. This pipeline is,</p>
<ol style="list-style-type: decimal">
<li>starting with our target word</li>
<li>getting the number of characters in that word</li>
<li>creating a sequence <code>1:nchar(x)</code>
</li>
<li>removing one character of the original target word for each
index</li>
<li>removing duplicates</li>
</ol>
<p>For example, if <code>x</code> were ‚Äúcats‚Äù, the pipeline would
generate:</p>
<pre><code>"ats" "cts" "cas" "cat"</code></pre>
<p>The next line returns a subset of the candidate words. Specifically,
only words found by <code>search_func</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">candidates</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">candidates</span>, <span class="va">search_func</span>, <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>So in our ‚Äúcats‚Äù example, only ‚Äúcat‚Äù would be returned because the
other three candidates are not real words.</p>
</div>
</div>
<div class="section level3">
<h3 id="search-algorithms">Search Algorithms<a class="anchor" aria-label="anchor" href="#search-algorithms"></a>
</h3>
<p>But what is <code>search_func</code>? Why didn‚Äôt we just use R‚Äôs
builtin <code>%in%</code> operator instead? Why go through the
trouble?</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">candidates</span><span class="op">[</span><span class="va">candidates</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">enable1</span><span class="op">]</span></span></code></pre></div>
<p>The short answer is that the <code>enable1</code> dataset is big!
Using <code>%in%</code> would be prohibitively slow if we had to run a
lot of these (foreshadowing). The <code>%in%</code> operator uses a
linear search algorithm, meaning that each member of the
<code>candidates</code> vector would have to be compared to each member
of the <code>enable1</code> vector. Worst case, that‚Äôs
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mo>√ó</mo><mn>172823</mn><mo>=</mo><mn>691292</mn></mrow><annotation encoding="application/x-tex">4 \times 172823 = 691292</annotation></semantics></math>
comparisons.</p>
<p>How can we reduce the number of comparisons?</p>
<div class="section level4">
<h4 id="binary-search">Binary Search<a class="anchor" aria-label="anchor" href="#binary-search"></a>
</h4>
<p>Since we know that <code>enable1</code> is sorted (or can be
‚Äútrivially‚Äù), we could use a binary search. That would reduce the number
of comparisons per candidate by log2, which means 18 comparisons worst
case. This package contains a <code><a href="../reference/search_func.html">binary_search()</a></code> function
implemented in pure R to demonstrate that.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binary_search</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">word</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">lb</span> <span class="op">&lt;-</span> <span class="fl">1L</span></span>
<span>    <span class="va">ub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">while</span> <span class="op">(</span><span class="va">lb</span> <span class="op">!=</span> <span class="va">ub</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">mid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ub</span>, <span class="va">lb</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1L</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">2L</span> <span class="op">+</span> <span class="fl">1L</span></span>
<span>      <span class="co"># message("lb: ", lb, ", ub: ", ub, ", mid: ", mid)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">word</span> <span class="op">==</span> <span class="va">table</span><span class="op">[</span><span class="va">mid</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">word</span> <span class="op">&gt;</span> <span class="va">table</span><span class="op">[</span><span class="va">mid</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">lb</span> <span class="op">&lt;-</span> <span class="va">mid</span> <span class="op">+</span> <span class="fl">1L</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">ub</span> <span class="op">&lt;-</span> <span class="va">mid</span> <span class="op">-</span> <span class="fl">1L</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">word</span> <span class="op">==</span> <span class="va">table</span><span class="op">[</span><span class="va">lb</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Note that it is a function that returns a function. This is a
closure. The reason we are doing this is because we want to prep our
input table (make sure it‚Äôs sorted). By returning a closure, we have our
own private version of the enable1 dataset that we <strong>know</strong>
is sorted because we sorted it in advance.</p>
<p>It may be that the performance is acceptable and we can end here. By
using the right algorithm, we could have obviated the need to use some
exotic Rcpp data structure. But let‚Äôs confirm that. Two data structures
may be of interest here since they can test membership with a single
comparison (on average): hashmaps and sets.</p>
</div>
<div class="section level4">
<h4 id="hash-table">Hash Table<a class="anchor" aria-label="anchor" href="#hash-table"></a>
</h4>
<p>As of R 4.2.0, there is a builtin <code><a href="https://rdrr.io/r/utils/hashtab.html" class="external-link">hashtab()</a></code> function
that allows us to work with hashmaps right in R without needing to use
the C++ STL. This package has implemented that search function with
<code><a href="../reference/search_func.html">hashtab_search()</a></code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hashtab_search</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/hashtab.html" class="external-link">hashtab</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">e</span> <span class="kw">in</span> <span class="va">table</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/hashtab.html" class="external-link">sethash</a></span><span class="op">(</span><span class="va">h</span>, <span class="va">e</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">word</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/hashtab.html" class="external-link">gethash</a></span><span class="op">(</span><span class="va">h</span>, <span class="va">word</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="set">Set<a class="anchor" aria-label="anchor" href="#set"></a>
</h4>
<p>There is no builtin set data type in R. So for the
<code><a href="../reference/search_func.html">set_search()</a></code> function, we will need to enlist Rcpp. In this
case, we will create a C++
<code>std::unordered_set&lt;std::string&gt;</code> and pass it around by
wrapping it in an <code>Rcpp::Xptr</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>XPtr<span class="op">&lt;</span><span class="bu">std::</span>unordered_set<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;&gt;</span> initialize_set<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> <span class="op">&amp;</span>s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="bu">std::</span>unordered_set<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;*</span> uset <span class="op">=</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>    <span class="kw">new</span> <span class="bu">std::</span>unordered_set<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;(</span>s<span class="op">.</span>begin<span class="op">(),</span> s<span class="op">.</span>end<span class="op">());</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  XPtr<span class="op">&lt;</span><span class="bu">std::</span>unordered_set<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;&gt;</span> xptr<span class="op">(</span>uset<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  <span class="cf">return</span> xptr<span class="op">;</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The search function itself is quite simple.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">set_search</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initialize_set.html">initialize_set</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">word</span><span class="op">)</span> <span class="fu">set_contains</span><span class="op">(</span><span class="va">word</span>, <span class="va">table</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This is another advantage of using closures: we can hide the gory
details of creating an <code>Xptr</code>. Now,
<code>set_contains()</code> can remain a private function (in Rcpp), and
we don‚Äôt have to explain to the end-user what this <code>Xptr</code> is
and that they must create it first and then remember to pass it into
<code>set_contains()</code>. That would be a lot of background knowledge
that would need to be communicated in the documentation but would not
add much to solving the primary problem of testing for membership in a
set.</p>
</div>
<div class="section level4">
<h4 id="benchmark">Benchmark<a class="anchor" aria-label="anchor" href="#benchmark"></a>
</h4>
<p>Now that we‚Äôve covered the theory(?) of the various benefits of each
search function, let‚Äôs confirm our intuition with a benchmark.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">enable1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">seq_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_func.html">sequential_search</a></span><span class="op">(</span><span class="va">enable1</span><span class="op">)</span></span>
<span><span class="va">bin_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_func.html">binary_search</a></span><span class="op">(</span><span class="va">enable1</span><span class="op">)</span></span>
<span><span class="va">hash_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_func.html">hashtab_search</a></span><span class="op">(</span><span class="va">enable1</span><span class="op">)</span></span>
<span><span class="va">set_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_func.html">set_search</a></span><span class="op">(</span><span class="va">enable1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/pt1_bonus.html">pt1_bonus</a></span><span class="op">(</span><span class="st">"cats"</span>, <span class="va">seq_s</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/pt1_bonus.html">pt1_bonus</a></span><span class="op">(</span><span class="st">"cats"</span>, <span class="va">bin_s</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/pt1_bonus.html">pt1_bonus</a></span><span class="op">(</span><span class="st">"cats"</span>, <span class="va">hash_s</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/pt1_bonus.html">pt1_bonus</a></span><span class="op">(</span><span class="st">"cats"</span>, <span class="va">set_s</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 √ó 6</span></span></span>
<span><span class="co">#&gt;   expression                         min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">"</span>pt1_bonus(\"cats\", seq_s)<span style="color: #949494;">"</span>    2.71ms   2.93ms      320.    5.29MB    47.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="color: #949494;">"</span>pt1_bonus(\"cats\", bin_s)<span style="color: #949494;">"</span>  100.18¬µs 110.07¬µs     <span style="text-decoration: underline;">8</span>041.        0B    11.9 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="color: #949494;">"</span>pt1_bonus(\"cats\", hash_s)<span style="color: #949494;">"</span>  24.91¬µs  27.53¬µs    <span style="text-decoration: underline;">34</span>090.    2.69KB    10.2 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> <span style="color: #949494;">"</span>pt1_bonus(\"cats\", set_s)<span style="color: #949494;">"</span>   25.06¬µs  27.98¬µs    <span style="text-decoration: underline;">32</span>908.    2.38KB     9.88</span></span></code></pre></div>
<p>The binary search was 45 times faster than the naive linear search,
and both the set and hashmap were about 200x faster. It may come as a
surprise that the hashmap is comparable to the much more complicated set
implementation. For the same performance, we can use an R builtin and
save the trouble of all that extra complication from Rcpp. However, the
<code><a href="https://rdrr.io/r/utils/hashtab.html" class="external-link">hashtab()</a></code> function is relatively new and still in the
experimental phase; it is possible that a set may have still been
necessary, depending on the target environment.</p>
<p>This is another reminder that Rcpp is a powerful tool but not always
necessary. In fact, for many cases, the pure R binary search solution
may be fast enough. However, if one had to do an exhaustive search of
the all 173k words of the enable1 list, performance matters. It could be
the difference between hours and seconds of runtime.</p>
<p>Which is a great segue into our next challenge.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="part-1-bonus-2">Part 1 Bonus 2<a class="anchor" aria-label="anchor" href="#part-1-bonus-2"></a>
</h2>
<div class="section level3">
<h3 id="prompt-2">Prompt<a class="anchor" aria-label="anchor" href="#prompt-2"></a>
</h3>
<blockquote>
<p>Given an input word from enable1, the largest number of words that
can be returned from <code>bonus(word)</code> is 5. One such input is
‚Äúboats‚Äù. There are 28 such inputs in total. Find them all.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="solution-2">Solution<a class="anchor" aria-label="anchor" href="#solution-2"></a>
</h3>
<p>With a good foundation built from the previous challenge, this is
straightforward. The solution subsets the enable1 database to include
only words with 5 characters or more but otherwise we do no tricks.
There are some micro-optimizations that could be attempted but this runs
sufficiently quickly as is. It‚Äôs about 17s on my laptop.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pt1_bonus2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">table</span>, <span class="va">search_func</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">qualifying_words</span> <span class="op">&lt;-</span> <span class="va">table</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">5L</span><span class="op">]</span></span>
<span>  <span class="va">candidates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">qualifying_words</span>, <span class="va">pt1_bonus</span>, <span class="va">search_func</span><span class="op">)</span></span>
<span>  <span class="va">matches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">candidates</span><span class="op">)</span> <span class="op">==</span> <span class="fl">5L</span></span>
<span>  <span class="va">qualifying_words</span><span class="op">[</span><span class="va">matches</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="part-2">Part 2<a class="anchor" aria-label="anchor" href="#part-2"></a>
</h2>
<div class="section level3">
<h3 id="prompt-3">Prompt<a class="anchor" aria-label="anchor" href="#prompt-3"></a>
</h3>
<blockquote>
<p>A <em>word funnel</em> is a series of words formed by removing one
letter at a time from a starting word, keeping the remaining letters in
order. For the purpose of this challenge, a word is defined as an entry
in the enable1 word list. An example of a word funnel is:</p>
<pre><code>gnash =&gt; gash =&gt; ash =&gt; ah</code></pre>
<p>This word funnel has length 4, because there are 4 words in it.</p>
Given a word, determine the length of the longest word funnel that it
starts. You may optionally also return the funnel itself (or any funnel
tied for the longest, in the case of a tie).
</blockquote>
</div>
<div class="section level3">
<h3 id="example-output-2">Example Output<a class="anchor" aria-label="anchor" href="#example-output-2"></a>
</h3>
<pre><code>funnel2("gnash") =&gt; 4
funnel2("princesses") =&gt; 9
funnel2("turntables") =&gt; 5
funnel2("implosive") =&gt; 1
funnel2("programmer") =&gt; 2</code></pre>
</div>
<div class="section level3">
<h3 id="solution-3">Solution<a class="anchor" aria-label="anchor" href="#solution-3"></a>
</h3>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_funnel2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">search_func</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">loop</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">depth</span> <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span>
<span>    <span class="va">x</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/pt1_bonus.html">pt1_bonus</a></span><span class="op">(</span><span class="va">search_func</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">loop</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, depth <span class="op">=</span> <span class="va">depth</span> <span class="op">+</span> <span class="fl">1L</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">depth</span><span class="op">)</span></span>
<span>  <span class="fu">loop</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Each of these solutions build on each other. As you can see, we are
using <code><a href="../reference/pt1_bonus.html">pt1_bonus()</a></code> to get all valid funnel words for each
step.</p>
</div>
<div class="section level3">
<h3 id="recursion">Recursion<a class="anchor" aria-label="anchor" href="#recursion"></a>
</h3>
<p>The new concept to note here is the use of recursion. Since we need
to step into each possible branch of the funnel to see which is the
longest, recursion is a natural choice to solve the problem
concisely.</p>
<p>Recursive functions often have a wrapper around them so that the
function signatures are more friendly to the user. In the outer function
signature, the user specifies the root word and the search function to
be used. However, the inner function (<code>loop()</code> or
<code>go()</code> by convention) needs only to know the current word to
be tested and the current depth in the tree.</p>
<div class="section level4">
<h4 id="tail-call-optimization">Tail Call Optimization<a class="anchor" aria-label="anchor" href="#tail-call-optimization"></a>
</h4>
<p>One pitfall of recursive algorithms is the potential for stack
overflows when traversing too deeply into branches. That will not be an
issue here because we can expect a shallow depth; but it is something to
be aware of, especially when you‚Äôd like to implement an infinite loop
using recursion. There is an R function which prevents stack overflows
by doing tail call optimization (<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Tailcall.html" class="external-link"><code>Tailcall()</code></a>).
The recursive function needs to meet certain conditions and this
particular function would not be a candidate. But it‚Äôs a good tool to
keep in your back pocket.</p>
<p>I have an example of <code><a href="https://rdrr.io/r/base/Tailcall.html" class="external-link">Tailcall()</a></code> usage in my <a href="https://github.com/pegeler/conway/blob/346dd7e6535de3cd7c54a999d3e9454a377e5854/life/R/life.r#L42" class="external-link">Conway‚Äôs
Game of Life package</a> as an example of where this would come in handy
for creating infinite loops.</p>
</div>
</div>
<div class="section level3">
<h3 id="rcpp">Rcpp<a class="anchor" aria-label="anchor" href="#rcpp"></a>
</h3>
<p>The Rcpp solution looks similar but without the functional elements.
I tend to prefer the R version but acknowledge it may be excessively
terse.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="dt">int</span> cpp_funnel2<span class="op">(</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>    <span class="at">const</span> <span class="bu">std::</span>string<span class="op"> &amp;</span>x<span class="op">,</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>    <span class="at">const</span> XPtr<span class="op">&lt;</span><span class="bu">std::</span>unordered_set<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;&gt;</span> wordset</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>  <span class="dt">int</span> depth <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span> <span class="op">&amp;</span>s <span class="op">:</span> make_all_funnel_words<span class="op">(</span>x<span class="op">))</span></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>wordset<span class="op">-&gt;</span>count<span class="op">(</span>s<span class="op">)</span> <span class="op">==</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>      depth <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span>depth<span class="op">,</span> cpp_funnel2<span class="op">(</span>s<span class="op">,</span> wordset<span class="op">)</span> <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>  <span class="cf">return</span> depth<span class="op">;</span></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Note too that I opted to make a support function
<code>make_all_funnel_words()</code> to keep the function body from
getting too cluttered.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="bu">std::</span>unordered_set<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> make_all_funnel_words<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op"> &amp;</span>s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>s<span class="op">.</span>size<span class="op">()</span> <span class="op">&lt;</span> <span class="dv">2</span><span class="op">)</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">{};</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>  <span class="bu">std::</span>unordered_set<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> set<span class="op">(</span>s<span class="op">.</span>size<span class="op">());</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> len <span class="op">=</span> s<span class="op">.</span>size<span class="op">();</span> i <span class="op">&lt;</span> len<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>    set<span class="op">.</span>insert<span class="op">(</span>s<span class="op">.</span>substr<span class="op">(</span><span class="dv">0</span><span class="op">,</span> i<span class="op">)</span> <span class="op">+</span> s<span class="op">.</span>substr<span class="op">(</span>i <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> len <span class="op">-</span> i<span class="op">));</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>  <span class="cf">return</span> set<span class="op">;</span></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="benchmark-1">Benchmark<a class="anchor" aria-label="anchor" href="#benchmark-1"></a>
</h3>
<p>The benchmark shows about an 84x speed difference between the two,
which would make Rcpp the preferred choice if we were to do another
exhaustive search exercise.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">word_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initialize_set.html">initialize_set</a></span><span class="op">(</span><span class="va">enable1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/funnel2.html">r_funnel2</a></span><span class="op">(</span><span class="st">"princesses"</span>, <span class="va">hash_s</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/funnel2.html">cpp_funnel2</a></span><span class="op">(</span><span class="st">"princesses"</span>, <span class="va">word_set</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 √ó 6</span></span></span>
<span><span class="co">#&gt;   expression                            min  median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;bch:t&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:t&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">"</span>r_funnel2(\"princesses\", hash_‚Ä¶  1.16ms  1.31ms      728.    7.23KB     11.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="color: #949494;">"</span>cpp_funnel2(\"princesses\", wor‚Ä¶ 18.93¬µs 19.82¬µs    <span style="text-decoration: underline;">46</span>096.    2.38KB      0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="python">Python<a class="anchor" aria-label="anchor" href="#python"></a>
</h3>
<p>For comparison‚Äôs sake, we‚Äôll look at the Python solution I originally
made</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="kw">def</span> funnel2(word):</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>    max_depth <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>    candidates <span class="op">=</span> {word[:i] <span class="op">+</span> word[(i<span class="op">+</span><span class="dv">1</span>):] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(word))} <span class="op">&amp;</span> WORDS</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>    <span class="cf">for</span> candidate <span class="kw">in</span> candidates:</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>        max_depth <span class="op">=</span> <span class="bu">max</span>(funnel2(candidate) <span class="op">+</span> <span class="dv">1</span>, max_depth)</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>    <span class="cf">return</span> max_depth</span></code></pre></div>
<p>It looks very similar to the C++ version. But due to string slicing
and the set intersection operator, I did not need to create the
<code>make_all_funnel_words()</code> support function.</p>
<p>There might be some room for optimization here as well. Although the
set intersection operator <code>&amp;</code> offers a succinct syntax
here, I‚Äôd want to examine its impact on algorithmic complexity‚Äîit could
be that there is a more efficient way to remove invalid words at that
step (such as using an <code>if</code> condition in the set
comprehension). But I found this to be sufficiently fast at the time, so
it is worth the trade-off for simplicity of implementation.</p>
</div>
</div>
<div class="section level2">
<h2 id="part-2-bonus">Part 2 Bonus<a class="anchor" aria-label="anchor" href="#part-2-bonus"></a>
</h2>
<div class="section level3">
<h3 id="prompt-4">Prompt<a class="anchor" aria-label="anchor" href="#prompt-4"></a>
</h3>
<blockquote>
<p>Find the one word in the word list that starts a funnel of length
10.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="solution-4">Solution<a class="anchor" aria-label="anchor" href="#solution-4"></a>
</h3>
<p>Not too much to note here. The early exit matters, which is why this
is a for loop instead of vectorized. I did not write it in C++ because
the loop will iterate few enough times that it won‚Äôt really matter (I
suspect). I <em>did</em> use the C++ funnel function though.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pt2_bonus</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">words</span>, <span class="va">wordset</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">word</span> <span class="kw">in</span> <span class="va">words</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">10L</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="../reference/funnel2.html">cpp_funnel2</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">wordset</span><span class="op">)</span> <span class="op">==</span> <span class="fl">10L</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="part-2-bonus-2">Part 2 Bonus 2<a class="anchor" aria-label="anchor" href="#part-2-bonus-2"></a>
</h2>
<div class="section level3">
<h3 id="prompt-5">Prompt<a class="anchor" aria-label="anchor" href="#prompt-5"></a>
</h3>
<blockquote>
<p>For this bonus, you are allowed to remove more than one letter in a
single step of the word funnel. For instance, you may step from
<code>sideboard</code> to <code>sidebar</code> by removing the
<code>o</code> and the final <code>d</code> in a single step. With this
modified rule, it‚Äôs possible to get a funnel of length 12:</p>
<pre><code>preformationists =&gt;
preformationist =&gt;
preformations =&gt;
reformations =&gt;
reformation =&gt;
formation =&gt;
oration =&gt;
ration =&gt;
ratio =&gt;
rato =&gt;
rat =&gt;
at</code></pre>
<code>preformationists</code> is one of six words that begin a modified
funnel of length 12. Find the other five words.
</blockquote>
</div>
<div class="section level3">
<h3 id="solution-5">Solution<a class="anchor" aria-label="anchor" href="#solution-5"></a>
</h3>
<p>Because multiple deletions can happen at each step, we need to make a
new supporting function to generate candidate words.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> make_all_funnel_words_any_depth<span class="op">(</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>  <span class="at">const</span> <span class="bu">std::</span>string<span class="op"> &amp;</span>s<span class="op">,</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>  <span class="at">const</span> XPtr<span class="op">&lt;</span><span class="bu">std::</span>unordered_set<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;&gt;</span> wordset<span class="op">,</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>  <span class="dt">int</span> depth</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>  <span class="dt">int</span> word_len <span class="op">=</span> s<span class="op">.</span>size<span class="op">()</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>  <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> <span class="kw">final</span><span class="op">;</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a>  <span class="kw">auto</span> prev <span class="op">=</span> make_all_funnel_words<span class="op">(</span>s<span class="op">);</span></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a>  <span class="kw">auto</span> pred <span class="op">=</span> <span class="op">[</span>wordset<span class="op">](</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op"> &amp;</span>str<span class="op">){</span><span class="cf">return</span> wordset<span class="op">-&gt;</span>count<span class="op">(</span>str<span class="op">)</span> <span class="op">==</span> <span class="dv">1</span><span class="op">;};</span></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a>  <span class="cf">while</span> <span class="op">(</span>word_len <span class="op">&gt;</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> depth <span class="op">+</span> word_len <span class="op">&gt;</span> <span class="dv">10</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a>    <span class="bu">std::</span>unordered_set<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> curr<span class="op">(--</span>word_len<span class="op">);</span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span> <span class="op">&amp;</span>word <span class="op">:</span> prev<span class="op">)</span> <span class="op">{</span></span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a>      <span class="kw">auto</span> tmp <span class="op">=</span> make_all_funnel_words<span class="op">(</span>word<span class="op">);</span></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a>      <span class="bu">std::</span>move<span class="op">(</span>tmp<span class="op">.</span>begin<span class="op">(),</span> tmp<span class="op">.</span>end<span class="op">(),</span> <span class="bu">std::</span>inserter<span class="op">(</span>curr<span class="op">,</span> curr<span class="op">.</span>end<span class="op">()));</span></span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a>    <span class="bu">std::</span>copy_if<span class="op">(</span>prev<span class="op">.</span>begin<span class="op">(),</span> prev<span class="op">.</span>end<span class="op">(),</span> <span class="bu">std::</span>back_inserter<span class="op">(</span><span class="kw">final</span><span class="op">),</span> pred<span class="op">);</span></span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a>    prev <span class="op">=</span> <span class="bu">std::</span>move<span class="op">(</span>curr<span class="op">);</span></span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb30-20"><a href="#cb30-20" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">final</span><span class="op">;</span></span>
<span id="cb30-21"><a href="#cb30-21" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Now, we use recursion almost exactly as we did in
<code><a href="../reference/funnel2.html">cpp_funnel2()</a></code>. One difference is that I have created a
wrapper function to simplify the signature and do the final integer
comparison to determine if the depth was 12.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="dt">int</span> pt2_bonus2_loop<span class="op">(</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>    <span class="at">const</span> <span class="bu">std::</span>string<span class="op"> &amp;</span>x<span class="op">,</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>    <span class="at">const</span> XPtr<span class="op">&lt;</span><span class="bu">std::</span>unordered_set<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;&gt;</span> wordset<span class="op">,</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>    <span class="dt">int</span> depth <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>  <span class="dt">int</span> max_depth <span class="op">=</span> depth<span class="op">;</span></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span> <span class="op">&amp;</span>word <span class="op">:</span> make_all_funnel_words_any_depth<span class="op">(</span>x<span class="op">,</span> wordset<span class="op">,</span> depth<span class="op">))</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>    max_depth <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span>max_depth<span class="op">,</span> pt2_bonus2_loop<span class="op">(</span>word<span class="op">,</span> wordset<span class="op">,</span> depth <span class="op">+</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>  <span class="cf">return</span> max_depth<span class="op">;</span></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a><span class="dt">bool</span> pt2_bonus2<span class="op">(</span></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>    <span class="at">const</span> <span class="bu">std::</span>string<span class="op"> &amp;</span>x<span class="op">,</span></span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>    <span class="at">const</span> XPtr<span class="op">&lt;</span><span class="bu">std::</span>unordered_set<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;&gt;</span> wordset</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>  <span class="cf">return</span> pt2_bonus2_loop<span class="op">(</span>x<span class="op">,</span> wordset<span class="op">)</span> <span class="op">==</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<div class="section level4">
<h4 id="python-1">Python<a class="anchor" aria-label="anchor" href="#python-1"></a>
</h4>
<p>I also solved this bonus in Python a long time ago. I find it was
much easier to write and had a shorter runtime than my C++ solution. The
ease of writing can be attributed to the <code>itertools</code> library
(a personal favorite), the rich set API, and string slicing facilities
in Python.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> combinations</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="kw">def</span> bonus2(word, depth<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>    max_depth <span class="op">=</span> depth</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>    candidates <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>    i <span class="op">=</span> <span class="bu">len</span>(word) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&gt;</span> <span class="dv">1</span> <span class="kw">and</span> i <span class="op">+</span> depth <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>        candidates.update(</span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a>            {<span class="st">''</span>.join(c) <span class="cf">for</span> c <span class="kw">in</span> combinations(word, i)} <span class="op">&amp;</span> WORDS)</span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a>        i <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a>    <span class="cf">for</span> candidate <span class="kw">in</span> candidates:</span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a>        max_depth <span class="op">=</span> <span class="bu">max</span>(bonus2(candidate, depth <span class="op">+</span> <span class="dv">1</span>), max_depth)</span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a>    <span class="cf">return</span> max_depth</span>
<span id="cb32-15"><a href="#cb32-15" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" tabindex="-1"></a><span class="cf">assert</span> bonus2(<span class="st">"preformationists"</span>) <span class="op">==</span> <span class="dv">12</span></span></code></pre></div>
<p>I was also able to run on several cores since this assignment is
embarassingly parallel.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="im">import</span> multiprocessing <span class="im">as</span> mp</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="kw">def</span> _check(word):</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>    <span class="cf">if</span> bonus2(word) <span class="op">==</span> <span class="dv">12</span>:</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>        <span class="cf">return</span> word</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Explicit for clarity</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a><span class="kw">def</span> run_bonus2():</span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a>    found <span class="op">=</span> []</span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a>    words <span class="op">=</span> (w <span class="cf">for</span> w <span class="kw">in</span> WORDS <span class="cf">if</span> <span class="bu">len</span>(w) <span class="op">&gt;</span> <span class="dv">12</span>)</span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a>    <span class="cf">with</span> mp.Pool(mp.cpu_count()) <span class="im">as</span> pool:</span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a>        <span class="cf">for</span> word <span class="kw">in</span> pool.imap_unordered(_check, words):</span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a>            <span class="cf">if</span> word <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a>            found.append(word)</span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(found) <span class="op">==</span> <span class="dv">6</span>:</span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a>                <span class="cf">return</span> found</span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Rcpp is a powerful tool for R programmers when speed is important.
However, exploring algorithmic optimizations and base R functionality
should not be discounted. Frequently, using Rcpp is unnecessary,
especially when working in R‚Äôs strength domains (numeric computation and
graphics). Trying several methods and measuring performance on real data
using benchmarks is an important part of the process when considering
whether Rcpp is the right tool for a job. Non-technical factors, such as
intended audience and expected lifetime of the code also play a role in
the decision on whether to use Rcpp.</p>
<p>Package-based project compendia augment problem solving in several
ways. Chief among them is maintaining a desired level of abstraction so
that the focus always remains on the immediate solution. Compendium
packages are a shareable unit of distribution that takes full advantage
of R‚Äôs builtin package management system, including dependency
management, automated unit tests and checks, documentation, write-ups
(vignettes), external data management, build and compilation tools and
configuration. Packages also enforce a standardized scaffolding for code
organization. All of this promotes reproducibility.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Paul Egeler.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
